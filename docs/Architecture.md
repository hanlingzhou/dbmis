# DBMIS 软件架构文档

## 1. 系统架构概述

DBMIS（数据库管理信息系统）采用经典的三层架构设计，包括前端展示层、后端应用层和数据存储层。系统设计遵循模块化、松耦合的原则，各层之间通过标准接口进行通信，使系统具有良好的扩展性和可维护性。

### 1.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                           客户端 (Client)                            │
│                                                                     │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐           │
│   │  视图层     │     │  状态管理   │     │   工具层    │           │
│   │  (Views)    │     │  (Pinia)    │     │ (Utilities) │           │
│   └─────────────┘     └─────────────┘     └─────────────┘           │
│             │                │                   │                   │
│             └────────────────┼───────────────────┘                   │
│                              │                                       │
│                      ┌───────────────┐                               │
│                      │    路由层     │                               │
│                      │   (Router)    │                               │
│                      └───────────────┘                               │
│                              │                                       │
│                      ┌───────────────┐                               │
│                      │   HTTP客户端  │                               │
│                      │   (Axios)     │                               │
│                      └───────────────┘                               │
└─────────────────────────────┬───────────────────────────────────────┘
                              │
                              │ HTTP/HTTPS
                              │
┌─────────────────────────────┼───────────────────────────────────────┐
│                             │                                        │
│                     ┌───────────────┐                                │
│                     │  API层(路由)  │                                │
│                     │   (Routes)    │                                │
│                     └───────────────┘                                │
│                             │                                        │
│                     ┌───────────────┐                                │
│                     │   中间件层    │                                │
│                     │ (Middleware)  │                                │
│                     └───────────────┘                                │
│                             │                                        │
│          ┌──────────────────┼─────────────────┐                      │
│          │                  │                 │                      │
│   ┌─────────────┐    ┌─────────────┐   ┌─────────────┐              │
│   │  认证服务   │    │  业务逻辑   │   │  数据服务   │              │
│   │   (Auth)    │    │  (Business) │   │   (Data)    │              │
│   └─────────────┘    └─────────────┘   └─────────────┘              │
│                                                                      │
│                           服务器 (Server)                            │
└─────────────────────────────┬──────────────────────────────────────┘
                              │
                              │ SQL查询
                              │
┌─────────────────────────────┼──────────────────────────────────────┐
│                      ┌─────────────┐                                │
│                      │  数据库连接 │                                │
│                      │   (Pool)    │                                │
│                      └─────────────┘                                │
│                              │                                       │
│          ┌──────────────────┼──────────────────┐                    │
│          │                  │                  │                    │
│   ┌─────────────┐    ┌─────────────┐    ┌─────────────┐            │
│   │   用户表    │    │  业务数据表 │    │  系统配置表 │            │
│   │   (users)   │    │(business_*) │    │  (configs)  │            │
│   └─────────────┘    └─────────────┘    └─────────────┘            │
│                                                                     │
│                        MySQL 数据库                                 │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 分层设计

#### 1.2.1 前端层 (Client)

前端采用Vue.js 3框架构建，具有以下主要组件：

- **视图层 (Views)**: 用户界面组件，负责数据展示和用户交互
- **状态管理 (Pinia)**: 管理应用全局状态，如用户认证信息
- **路由层 (Router)**: 处理客户端路由和视图切换
- **HTTP客户端 (Axios)**: 负责与后端API通信

#### 1.2.2 后端层 (Server)

后端采用Node.js + Express框架构建，包含以下主要组件：

- **API路由 (Routes)**: 定义REST API端点
- **中间件层 (Middleware)**: 处理认证、日志等横切关注点
- **业务逻辑层 (Business Logic)**: 实现系统核心业务功能
- **数据访问层 (Data Access)**: 封装数据库操作

#### 1.2.3 数据存储层 (Database)

采用MySQL关系型数据库存储系统数据：

- **用户数据**: 存储用户账号和权限信息
- **业务数据**: 存储业务相关信息和统计数据
- **系统数据**: 存储系统配置和日志等信息

## 2. 技术选型详情

### 2.1 前端技术栈

| 技术/框架         | 版本   | 作用                         | 选型理由                                     |
|-------------------|--------|------------------------------|----------------------------------------------|
| Vue.js            | 3.x    | 前端框架                     | 响应式数据绑定，组件化开发，良好的生态系统   |
| Element Plus      | 2.x    | UI组件库                     | 美观的界面组件，丰富的交互元素               |
| Pinia             | 2.x    | 状态管理                     | Vue 3官方推荐的状态管理库，类型安全         |
| Vue Router        | 4.x    | 客户端路由                   | Vue官方路由库，支持路由嵌套和导航守卫        |
| Axios             | 1.x    | HTTP客户端                   | 基于Promise的HTTP客户端，支持拦截器          |
| ECharts           | 5.x    | 数据可视化                   | 功能丰富的图表库，支持各种复杂图表           |
| Vite              | 4.x    | 构建工具                     | 快速的开发服务器和构建工具                   |

### 2.2 后端技术栈

| 技术/框架         | 版本   | 作用                         | 选型理由                                     |
|-------------------|--------|------------------------------|----------------------------------------------|
| Node.js           | 16+    | 运行环境                     | 非阻塞I/O，高性能，适合构建API服务器         |
| Express           | 4.x    | Web框架                      | 轻量级，灵活，易于扩展                       |
| MySQL2            | 3.x    | 数据库驱动                   | 支持Promise/async/await，性能优于mysql       |
| JSON Web Token    | 9.x    | 认证方案                     | 无状态认证，适合RESTful API                  |
| bcrypt            | 5.x    | 密码哈希                     | 安全的密码存储方案                           |
| CORS              | 2.x    | 跨域资源共享                 | 处理跨域请求                                 |
| dotenv            | 16.x   | 环境变量管理                 | 管理各环境的配置信息                         |

### 2.3 数据库设计

#### 2.3.1 主要数据表

| 表名                | 作用                            | 关键字段                              |
|---------------------|----------------------------------|---------------------------------------|
| users               | 存储用户账号信息                | id, username, password, role, status  |
| regions             | 存储地区信息                    | id, name, code, status                |
| business_categories | 存储业务分类                    | id, name, description, status         |
| business_services   | 存储具体业务服务                | id, name, category_id, description    |
| business_data       | 存储业务数据                    | year, month, region_id, service_id, value |

#### 2.3.2 数据关系图

```
┌─────────────┐       ┌─────────────┐       ┌─────────────┐
│    users    │       │   regions   │       │ business_   │
│             │       │             │       │ categories  │
└─────────────┘       └─────────────┘       └─────────────┘
       │                     │                      │
       │                     │                      │
       │                     │                      │
       │                     │                      │
       │                     │                      │
       ▼                     │                      ▼
┌─────────────┐             │              ┌─────────────┐
│   system    │             │              │  business_  │
│    logs     │             │              │  services   │
└─────────────┘             │              └─────────────┘
                            │                      │
                            │                      │
                            ▼                      ▼
                      ┌─────────────────────────────┐
                      │       business_data         │
                      │                             │
                      └─────────────────────────────┘
```

## 3. 系统模块设计

### 3.1 用户认证模块

- **功能职责**: 用户登录、身份验证、密码管理
- **设计模式**: JWT基于令牌的无状态认证
- **关键组件**:
  - AuthMiddleware: 验证请求中的JWT令牌
  - UserModel: 用户数据操作
  - AuthController: 处理登录和身份验证逻辑

### 3.2 业务数据管理模块

- **功能职责**: 业务数据的CRUD操作
- **设计模式**: MVC模式
- **关键组件**:
  - BusinessController: 处理业务数据请求
  - BusinessService: 实现业务逻辑
  - DataModels: 数据访问层

### 3.3 数据分析模块

- **功能职责**: 数据统计、分析和可视化
- **设计模式**: 策略模式，用于不同类型的数据分析
- **关键组件**:
  - AnalyticsController: 处理分析请求
  - AnalyticsService: 实现分析逻辑
  - ChartComponent: 前端图表展示

### 3.4 系统管理模块

- **功能职责**: 用户管理、系统配置、日志查看
- **设计模式**: 单例模式（系统配置）
- **关键组件**:
  - AdminController: 处理管理请求
  - UserService: 用户管理逻辑
  - LogService: 日志管理逻辑

## 4. 安全设计

### 4.1 认证与授权

- **JWT认证**: 使用JSON Web Token进行无状态认证
- **RBAC权限模型**: 基于角色的访问控制
- **密码安全**: 使用bcrypt算法进行密码哈希

### 4.2 数据安全

- **SQL注入防护**: 使用参数化查询
- **XSS防护**: 前端输入验证和输出转义
- **CSRF防护**: 使用适当的CORS配置

### 4.3 通信安全

- **HTTPS**: 生产环境中启用HTTPS加密
- **API速率限制**: 防止暴力攻击
- **请求验证**: 验证所有接口参数

## 5. 性能优化

### 5.1 前端优化

- **代码分割**: 按路由进行代码分割，减小初始加载体积
- **延迟加载**: 非关键组件延迟加载
- **缓存策略**: 使用浏览器缓存和本地存储
- **虚拟滚动**: 大列表使用虚拟滚动提高性能

### 5.2 后端优化

- **连接池**: 使用数据库连接池提高数据库访问效率
- **缓存**: 使用内存缓存减少数据库查询
- **查询优化**: 使用索引和优化的SQL查询
- **负载均衡**: 支持多实例部署和负载均衡

## 6. 部署架构

### 6.1 开发环境

```
┌───────────────┐     ┌───────────────┐
│   前端服务器  │     │   后端服务器  │
│   (Vite Dev)  │     │  (Node Dev)   │
│  localhost:5173│     │ localhost:3001│
└───────────────┘     └───────────────┘
        │                     │
        │                     │
        ▼                     ▼
┌────────────────────────────────┐
│          MySQL数据库           │
│        localhost:3306          │
└────────────────────────────────┘
```

### 6.2 生产环境

```
┌───────────────┐
│   负载均衡器  │
│    (Nginx)    │
└───────────────┘
        │
        ├────────────┬────────────┐
        │            │            │
┌───────────────┐    │      ┌───────────────┐
│  Node实例 1   │    │      │  Node实例 2   │
│ (API + 静态)  │    │      │ (API + 静态)  │
└───────────────┘    │      └───────────────┘
        │            │            │
        │            │            │
        ▼            ▼            ▼
┌────────────────────────────────┐
│        MySQL主从复制           │
│                                │
└────────────────────────────────┘
```

## 7. 扩展性考虑

### 7.1 水平扩展

- **无状态设计**: 服务器无状态，便于扩展
- **分布式部署**: 支持多实例部署
- **数据库扩展**: 支持主从复制和读写分离

### 7.2 功能扩展

- **模块化设计**: 便于添加新模块
- **插件架构**: 关键组件支持插件扩展
- **API版本控制**: 支持API版本演进

## 8. 技术风险与缓解策略

| 风险                     | 影响               | 缓解策略                                    |
|--------------------------|--------------------|--------------------------------------------|
| 数据库性能瓶颈           | 系统响应变慢       | 优化索引，查询，实施缓存，考虑分库分表      |
| 前端框架版本兼容性       | 功能异常           | 完善测试，锁定依赖版本，渐进式升级          |
| API安全漏洞              | 数据泄露，系统入侵 | 定期安全审计，权限控制，输入验证            |
| 并发处理能力不足         | 高峰期系统崩溃     | 负载测试，限流机制，异步处理                |
| 系统可用性               | 服务中断           | 冗余部署，监控告警，自动恢复                |

---

## 9. 未来演进计划

- **微服务拆分**: 将系统拆分为更小的微服务
- **容器化部署**: 使用Docker和Kubernetes实现容器化
- **GraphQL API**: 在特定模块中引入GraphQL提高查询灵活性
- **实时数据更新**: 引入WebSocket支持数据实时推送
- **AI数据分析**: 引入机器学习算法进行数据预测和分析 